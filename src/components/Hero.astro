---
import '../styles/components/hero.css';
---

<section class="hero" id="home">
  <div class="hero-container container">
    <div class="hero-content" data-parallax="0.3">
      <div class="hero-decorator">
        <div class="decorator-dot"></div>
        <div class="decorator-line"></div>
      </div>
      
      <div class="hero-text">
        <h1 class="hero-title animate-fade-in-up">
          Hola, Soy <span class="text-gradient">Fernando</span>
        </h1>
        <p class="hero-subtitle animate-fade-in-up">
          Desarrollador<br class="mobile-br" />
          <span>Full Stack</span>
        </p>
        <p class="hero-description animate-fade-in-up">
          Creando experiencias web modernas con Angular y .NET
        </p>
        <div class="hero-cta animate-fade-in-up">
          <a href="#projects" class="btn btn-primary">Ver Proyectos</a>
          <a href="#contact" class="btn btn-outline">Contactar</a>
        </div>
      </div>
    </div>
    
    <div class="hero-visual" data-parallax="0.5">
      <div class="hero-image-wrapper">
        <div class="hero-avatar" id="bubble-container">
          <div class="avatar-glow"></div>
          <div class="orbital-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
          </div>
          <div class="avatar-content" id="astronaut">
            <img src="/assets/astronauta.webp" alt="Avatar de Fernando Martinez" class="avatar-image" loading="lazy" />
          </div>
          <!-- Fragmentos de la burbuja para el efecto de explosión -->
          <div class="bubble-fragments"></div>
        </div>
      </div>
    </div>
    
  </div>
</section>

<script>
  // Parallax effect
  window.addEventListener('scroll', () => {
    const elements = document.querySelectorAll('[data-parallax]');
    elements.forEach((el) => {
      const speed = parseFloat((el as HTMLElement).dataset.parallax || '0');
      const yPos = -(window.scrollY * speed);
      (el as HTMLElement).style.transform = `translateY(${yPos}px)`;
    });
  });

  // Bubble pop effect
  const bubbleContainer = document.getElementById('bubble-container');
  const astronaut = document.getElementById('astronaut');
  const fragmentsContainer = bubbleContainer?.querySelector('.bubble-fragments');
  let hasPopped = false;

  bubbleContainer?.addEventListener('click', () => {
    if (hasPopped) return;
    hasPopped = true;

    // Crear fragmentos de la burbuja
    const numFragments = 20;
    for (let i = 0; i < numFragments; i++) {
      const fragment = document.createElement('div');
      fragment.className = 'bubble-fragment';
      
      const angle = (Math.PI * 2 * i) / numFragments;
      const distance = 150 + Math.random() * 100;
      const tx = Math.cos(angle) * distance;
      const ty = Math.sin(angle) * distance;
      
      fragment.style.setProperty('--tx', `${tx}px`);
      fragment.style.setProperty('--ty', `${ty}px`);
      fragment.style.setProperty('--rotation', `${Math.random() * 720 - 360}deg`);
      fragment.style.setProperty('--delay', `${Math.random() * 0.1}s`);
      
      fragmentsContainer?.appendChild(fragment);
    }

    // Obtener el contenido del avatar para ocultar el borde
    const avatarContent = bubbleContainer?.querySelector('.avatar-content') as HTMLElement;
    
    // Animar la burbuja (glow) para que desaparezca
    const glow = bubbleContainer?.querySelector('.avatar-glow') as HTMLElement;
    if (glow) {
      glow.style.animation = 'bubblePop 0.5s ease-out forwards';
    }

    // Ocultar partículas orbitales
    const particles = bubbleContainer?.querySelector('.orbital-particles') as HTMLElement;
    if (particles) {
      particles.style.opacity = '0';
      particles.style.transition = 'opacity 0.3s ease-out';
    }

    // Animar el astronauta flotando al espacio con transiciones CSS suaves
    if (astronaut) {
      astronaut.style.transition = 'all 4.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      astronaut.style.transform = 'translate(400px, -700px) scale(0.05) rotate(720deg)';
      astronaut.style.opacity = '0';
    }

    // Ocultar el contenido del avatar (borde y fondo de la burbuja)
    if (avatarContent) {
      avatarContent.style.transition = 'all 5s ease-out';
      avatarContent.style.borderColor = 'transparent';
      avatarContent.style.backgroundColor = 'transparent';
      avatarContent.style.background = 'transparent';
      avatarContent.style.boxShadow = 'none';
    }

    // Añadir clase para el efecto de shake
    bubbleContainer?.classList.add('popping');

    // Limpiar después de la animación
    setTimeout(() => {
      bubbleContainer?.classList.add('popped');
      if (glow) glow.style.display = 'none';
      if (avatarContent) avatarContent.style.display = 'none';
    }, 4600);
  });
</script>
